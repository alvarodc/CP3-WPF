<Window x:Class="CardPass3.WPF.Modules.Shell.Views.ShellWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:CardPass3.WPF.Core.Converters"
        xmlns:vm="clr-namespace:CardPass3.WPF.Modules.Shell.ViewModels"
        Title="CardPass3"
        MinWidth="1100" MinHeight="680"
        Width="1280" Height="780"
        WindowStartupLocation="CenterScreen"
        WindowState="Normal"
        Background="{StaticResource BackgroundBrush}">

    <Window.Resources>
        <conv:BoolToVisibilityConverter   x:Key="BoolToVis"/>
        <conv:EqualityConverter           x:Key="EqualityConv"/>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220"/>   <!-- Sidebar -->
            <ColumnDefinition Width="*"/>     <!-- Content -->
        </Grid.ColumnDefinitions>

        <!-- ══════════════════════════════════════════════════
             SIDEBAR
        ══════════════════════════════════════════════════ -->
        <Grid Grid.Column="0" Background="{StaticResource SidebarBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="64"/>   <!-- Brand -->
                <RowDefinition Height="*"/>    <!-- Nav items -->
                <RowDefinition Height="Auto"/> <!-- Status + footer -->
            </Grid.RowDefinitions>

            <!-- Brand -->
            <Border Grid.Row="0"
                    BorderBrush="#22FFFFFF"
                    BorderThickness="0,0,0,1">
                <StackPanel Orientation="Horizontal"
                            VerticalAlignment="Center"
                            Margin="18,0,0,0">
                    <!-- Mini shield icon -->
                    <Viewbox Width="22" Height="22">
                        <Canvas Width="52" Height="52">
                            <Path Fill="#2196F3"
                                  Data="M26,2 L46,10 L46,28 C46,40 36,48 26,52 C16,48 6,40 6,28 L6,10 Z"/>
                            <Rectangle Fill="White" Width="14" Height="11"
                                       Canvas.Left="19" Canvas.Top="28" RadiusX="2" RadiusY="2"/>
                            <Path Stroke="White" StrokeThickness="2.5" Fill="Transparent"
                                  Data="M21,28 L21,24 C21,20.7 31,20.7 31,24 L31,28"/>
                        </Canvas>
                    </Viewbox>
                    <TextBlock Margin="10,0,0,0" VerticalAlignment="Center">
                        <Run Text="Card" Foreground="White" FontFamily="Segoe UI Light" FontSize="15"/>
                        <Run Text="Pass" Foreground="White" FontFamily="Segoe UI Light" FontSize="15"/>
                        <Run Text="3"    Foreground="#2196F3" FontFamily="Segoe UI Bold" FontSize="15"/>
                    </TextBlock>
                </StackPanel>
            </Border>

            <!-- Navigation items -->
            <StackPanel Grid.Row="1" Margin="0,16,0,0">

                <!-- Section: Control de paso -->
                <TextBlock Text="CONTROL DE PASO"
                           FontFamily="Segoe UI"
                           FontSize="10"
                           FontWeight="SemiBold"
                           Foreground="#4A6480"
                           Margin="18,8,0,4"/>

                <Button Style="{StaticResource NavButton}"
                        Command="{Binding NavigateCommand}" CommandParameter="pass">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE71D;" FontFamily="Segoe MDL2 Assets" FontSize="14" Width="20"/>
                        <TextBlock Text="Control de paso" Margin="10,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <Button Style="{StaticResource NavButton}"
                        Command="{Binding NavigateCommand}" CommandParameter="readers">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE8F9;" FontFamily="Segoe MDL2 Assets" FontSize="14" Width="20"/>
                        <TextBlock Text="Lectores" Margin="10,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Section: Usuarios -->
                <TextBlock Text="USUARIOS"
                           FontFamily="Segoe UI"
                           FontSize="10"
                           FontWeight="SemiBold"
                           Foreground="#4A6480"
                           Margin="18,16,0,4"/>

                <Button Style="{StaticResource NavButton}"
                        Command="{Binding NavigateCommand}" CommandParameter="users">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE77B;" FontFamily="Segoe MDL2 Assets" FontSize="14" Width="20"/>
                        <TextBlock Text="Usuarios" Margin="10,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <Button Style="{StaticResource NavButton}"
                        Command="{Binding NavigateCommand}" CommandParameter="events">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE823;" FontFamily="Segoe MDL2 Assets" FontSize="14" Width="20"/>
                        <TextBlock Text="Fichajes" Margin="10,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Section: Sistema -->
                <TextBlock Text="SISTEMA"
                           FontFamily="Segoe UI"
                           FontSize="10"
                           FontWeight="SemiBold"
                           Foreground="#4A6480"
                           Margin="18,16,0,4"/>

                <Button Style="{StaticResource NavButton}"
                        Command="{Binding NavigateCommand}" CommandParameter="areas">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE909;" FontFamily="Segoe MDL2 Assets" FontSize="14" Width="20"/>
                        <TextBlock Text="Áreas" Margin="10,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <Button Style="{StaticResource NavButton}"
                        Command="{Binding NavigateCommand}" CommandParameter="config">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE713;" FontFamily="Segoe MDL2 Assets" FontSize="14" Width="20"/>
                        <TextBlock Text="Configuración" Margin="10,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

            </StackPanel>

            <!-- Footer: readers status + logout -->
            <StackPanel Grid.Row="2">

                <!-- Reader connection progress -->
                <Border Margin="12,0,12,8"
                        Background="#0D2035"
                        CornerRadius="6"
                        Padding="12,10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="6"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <DockPanel Grid.Row="0">
                            <TextBlock Text="&#xE8F9;"
                                       FontFamily="Segoe MDL2 Assets"
                                       FontSize="11"
                                       Foreground="#4A6480"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding ReadersStatus}"
                                       FontFamily="Segoe UI"
                                       FontSize="11"
                                       Foreground="#7A9AB5"
                                       Margin="6,0,0,0"
                                       VerticalAlignment="Center"/>
                            <!-- Spinner while loading -->
                            <TextBlock Text="&#xE117;"
                                       FontFamily="Segoe MDL2 Assets"
                                       FontSize="11"
                                       Foreground="#2196F3"
                                       DockPanel.Dock="Right"
                                       VerticalAlignment="Center"
                                       Visibility="{Binding ReadersLoading, Converter={StaticResource BoolToVis}}"/>
                        </DockPanel>
                    </Grid>
                </Border>

                <!-- Separator -->
                <Border BorderBrush="#22FFFFFF" BorderThickness="0,1,0,0" Margin="12,0"/>

                <!-- Logout -->
                <Button Style="{StaticResource NavButton}"
                        Margin="0,4,8,12"
                        Command="{Binding LogoutCommand}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xF3B1;" FontFamily="Segoe MDL2 Assets" FontSize="14" Width="20" Foreground="#C62828"/>
                        <TextBlock Text="Cerrar sesión" Margin="10,0,0,0" VerticalAlignment="Center" Foreground="#EF9A9A"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- ══════════════════════════════════════════════════
             CONTENT AREA
        ══════════════════════════════════════════════════ -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="56"/>   <!-- Topbar -->
                <RowDefinition Height="*"/>    <!-- View -->
            </Grid.RowDefinitions>

            <!-- Topbar -->
            <Border Grid.Row="0"
                    Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,0,0,1">
                <DockPanel Margin="24,0">
                    <!-- Page title (bound to current module) -->
                    <TextBlock Text="{Binding CurrentModuleTitle}"
                               FontFamily="Segoe UI Semibold"
                               FontSize="14"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               VerticalAlignment="Center"/>

                    <!-- Right: operator name + date -->
                    <StackPanel DockPanel.Dock="Right"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <TextBlock Text="{Binding CurrentOperatorName}"
                                   FontFamily="Segoe UI"
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"/>
                        <Ellipse Width="5" Height="5"
                                 Fill="{StaticResource BorderBrush}"
                                 Margin="10,0"/>
                        <TextBlock x:Name="TxtClock"
                                   FontFamily="Segoe UI"
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </DockPanel>
            </Border>

            <!-- Module view host -->
            <ContentControl Grid.Row="1"
                            Content="{Binding CurrentView}"
                            Margin="24"/>
        </Grid>
    </Grid>
</Window>
